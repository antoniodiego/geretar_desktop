{
    "sourceFile": "src/main/java/br/com/antoniodiego/gertarefas/ui/principal/paineis/PainelFuncoes.java",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1751340800144,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1751341836076,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,9 +5,9 @@\n  */\n package br.com.antoniodiego.gertarefas.ui.principal.paineis;\n \n import br.com.antoniodiego.gertarefas.model.ModeloTabelaTarefasLista;\n-import br.com.antoniodiego.gertarefas.persist.daos.DAOTarefa;\n+import br.com.antoniodiego.gertarefas.persist.DAOTarefa;\n import br.com.antoniodiego.gertarefas.pojo.Tarefa;\n import br.com.antoniodiego.gertarefas.ui.dialogos.editartarefa.DialogoEditarTarefa;\n import br.com.antoniodiego.gertarefas.ui.principal.JanelaPrincipalMatisse;\n import br.com.antoniodiego.gertarefas.ui.vercomentarios.DialogoVerComentarios;\n"
                }
            ],
            "date": 1751340800144,
            "name": "Commit-0",
            "content": "/*\n * To change this license header, choose License Headers in Project Properties.\n * To change this template file, choose Tools | Templates\n * and open the template in the editor.\n */\npackage br.com.antoniodiego.gertarefas.ui.principal.paineis;\n\nimport br.com.antoniodiego.gertarefas.model.ModeloTabelaTarefasLista;\nimport br.com.antoniodiego.gertarefas.persist.daos.DAOTarefa;\nimport br.com.antoniodiego.gertarefas.pojo.Tarefa;\nimport br.com.antoniodiego.gertarefas.ui.dialogos.editartarefa.DialogoEditarTarefa;\nimport br.com.antoniodiego.gertarefas.ui.principal.JanelaPrincipalMatisse;\nimport br.com.antoniodiego.gertarefas.ui.vercomentarios.DialogoVerComentarios;\n\nimport static br.com.antoniodiego.gertarefas.ui.principal.paineis.PainelTabelaTarefas.LOG_PAINEL_T;\n\nimport java.time.LocalDateTime;\nimport javax.swing.JTable;\nimport javax.swing.ListSelectionModel;\nimport javax.swing.table.TableRowSorter;\n\n/**\n *\n * @author Antônoio Diego <antoniodiegoluz at gmail.com>\n */\npublic class PainelFuncoes extends javax.swing.JPanel {\n\n    private ModeloTabelaTarefasLista modeloTabela;\n    private JTable tabelaTarefas;\n    private JanelaPrincipalMatisse dono;\n\n    /**\n     * Creates new form PainelFuncoes\n     *\n     */\n    public PainelFuncoes() {\n\n        initComponents();\n    }\n\n    /**\n     * Creates new form PainelFuncoes\n     *\n     * @param painelTabelaTarefas\n     * @param dono Referência à janela principal, pode ser mais generalizada\n     * para um JFrame, mas é importante passar uma ref da janela principal para\n     * o diálogo comentários. Ao menos uma ref para o modelo da tabela\n     */\n    public PainelFuncoes(PainelTabelaTarefas painelTabelaTarefas,\n            JanelaPrincipalMatisse dono) {\n        this.dono = dono;\n\n        this.modeloTabela = painelTabelaTarefas.getModeloTabela();\n        this.tabelaTarefas = painelTabelaTarefas.getTabelaTarefas();\n\n        initComponents();\n    }\n\n    /**\n     * This method is called from within the constructor to initialize the form.\n     * WARNING: Do NOT modify this code. The content of this method is always\n     * regenerated by the Form Editor.\n     */\n    @SuppressWarnings(\"unchecked\")\n    // <editor-fold defaultstate=\"collapsed\" desc=\"Generated Code\">//GEN-BEGIN:initComponents\n    private void initComponents() {\n\n        btAumentPrio = new javax.swing.JButton();\n        btDiminuiPrio = new javax.swing.JButton();\n        btSubir = new javax.swing.JButton();\n        btDescer = new javax.swing.JButton();\n        btVerTarefa = new javax.swing.JButton();\n        btVerComentarios = new javax.swing.JButton();\n\n        btAumentPrio.setText(\"Prioridade +\");\n        btAumentPrio.setToolTipText(\"Aumentar a prioridade da tarefa\");\n        btAumentPrio.addActionListener(new java.awt.event.ActionListener() {\n            public void actionPerformed(java.awt.event.ActionEvent evt) {\n                btAumentPrioActionPerformed(evt);\n            }\n        });\n\n        btDiminuiPrio.setText(\"Prioridade -\");\n        btDiminuiPrio.addActionListener(new java.awt.event.ActionListener() {\n            public void actionPerformed(java.awt.event.ActionEvent evt) {\n                btDiminuiPrioActionPerformed(evt);\n            }\n        });\n\n        btSubir.setText(\"Para cima\");\n        btSubir.setToolTipText(\"Mover a tarefa para cima na lista\");\n        btSubir.addActionListener(new java.awt.event.ActionListener() {\n            public void actionPerformed(java.awt.event.ActionEvent evt) {\n                btSubirActionPerformed(evt);\n            }\n        });\n\n        btDescer.setText(\"Para baixo\");\n        btDescer.addActionListener(new java.awt.event.ActionListener() {\n            public void actionPerformed(java.awt.event.ActionEvent evt) {\n                btDescerActionPerformed(evt);\n            }\n        });\n\n        btVerTarefa.setText(\"Ver\");\n        btVerTarefa.setToolTipText(\"Ver e editar detalhes da tarefa\");\n        btVerTarefa.addActionListener(new java.awt.event.ActionListener() {\n            public void actionPerformed(java.awt.event.ActionEvent evt) {\n                btVerTarefaActionPerformed(evt);\n            }\n        });\n\n        btVerComentarios.setText(\"Comentários\");\n        btVerComentarios.addActionListener(new java.awt.event.ActionListener() {\n            public void actionPerformed(java.awt.event.ActionEvent evt) {\n                btVerComentariosActionPerformed(evt);\n            }\n        });\n\n        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);\n        this.setLayout(layout);\n        layout.setHorizontalGroup(\n            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addGroup(layout.createSequentialGroup()\n                .addGap(12, 12, 12)\n                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)\n                    .addComponent(btSubir, javax.swing.GroupLayout.DEFAULT_SIZE, 103, Short.MAX_VALUE)\n                    .addComponent(btDiminuiPrio, javax.swing.GroupLayout.DEFAULT_SIZE, 103, Short.MAX_VALUE)\n                    .addComponent(btAumentPrio, javax.swing.GroupLayout.DEFAULT_SIZE, 103, Short.MAX_VALUE)\n                    .addComponent(btDescer, javax.swing.GroupLayout.DEFAULT_SIZE, 103, Short.MAX_VALUE)\n                    .addComponent(btVerTarefa, javax.swing.GroupLayout.DEFAULT_SIZE, 103, Short.MAX_VALUE)\n                    .addComponent(btVerComentarios, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))\n                .addContainerGap(13, Short.MAX_VALUE))\n        );\n        layout.setVerticalGroup(\n            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)\n            .addGroup(layout.createSequentialGroup()\n                .addContainerGap()\n                .addComponent(btSubir)\n                .addGap(18, 18, 18)\n                .addComponent(btDescer)\n                .addGap(18, 18, 18)\n                .addComponent(btVerTarefa)\n                .addGap(18, 18, 18)\n                .addComponent(btVerComentarios)\n                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)\n                .addComponent(btAumentPrio)\n                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)\n                .addComponent(btDiminuiPrio)\n                .addContainerGap(135, Short.MAX_VALUE))\n        );\n    }// </editor-fold>//GEN-END:initComponents\n\n    private void btAumentPrioActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAumentPrioActionPerformed\n        LOG_PAINEL_T.traceEntry();\n\n//        JTable tabelaTarefas = painelTabelaTarefas.getTabelaTarefas();\n//        ModeloTabelaTarefasLista modeloTabela = painelTabelaTarefas.getModeloTabela();\n        // A linha escolhida na tabela\n        int linhaSel = tabelaTarefas.getSelectedRow();\n\n        LOG_PAINEL_T.debug(\"Linha tab: \" + linhaSel);\n\n        // Posição da tarefa no modelo\n        int posicaoSelModelo = tabelaTarefas.convertRowIndexToModel(linhaSel);\n\n        LOG_PAINEL_T.debug(\"Posição: \" + posicaoSelModelo);\n\n        Tarefa tarefaAlterar = modeloTabela.getTarefas().get(posicaoSelModelo);\n\n        LOG_PAINEL_T.debug(\"Tarefa akterada: \" + tarefaAlterar.getTitulo());\n\n        tarefaAlterar.aumentaPrio();\n        tarefaAlterar.setDataModif(LocalDateTime.now());\n        DAOTarefa daoT = new DAOTarefa();\n        daoT.atualiza(tarefaAlterar);\n\n        LOG_PAINEL_T.debug(\"Fire atualizado: \" + linhaSel);\n\n        int idxCol = tabelaTarefas.getColumn(\"Prioridade\").getModelIndex();\n        modeloTabela.fireTableCellUpdated(linhaSel, idxCol);\n\n        int idxColM = tabelaTarefas.getColumn(\"Data modif\").getModelIndex();\n\n        modeloTabela.fireTableCellUpdated(linhaSel, idxColM);\n        ((TableRowSorter) tabelaTarefas.getRowSorter()).sort();\n    }//GEN-LAST:event_btAumentPrioActionPerformed\n\n    private void btSubirActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btSubirActionPerformed\n        LOG_PAINEL_T.traceEntry();\n\n//        JTable tabelaTarefas = painelTabelaTarefas.getTabelaTarefas();\n//        ModeloTabelaTarefasLista modeloTabela = painelTabelaTarefas.getModeloTabela();\n        // A linha escolhida na tabela\n        int linhaSel = tabelaTarefas.getSelectedRow();\n\n        // Posição da tarefa no modelo\n        int posicaoSelModelo = tabelaTarefas.convertRowIndexToModel(linhaSel);\n\n        Tarefa tarefaMover = modeloTabela.getTarefas().get(posicaoSelModelo);\n\n        if (tarefaMover.getPosicao() <= 0) {\n            return;\n        }\n\n        LOG_PAINEL_T.debug(\"Pos {} maior que 0\", tarefaMover.getTitulo());\n\n        // Remove a posição dela\n        DAOTarefa daoT = new DAOTarefa();\n\n        Integer posicaoAt = tarefaMover.getPosicao();\n        LOG_PAINEL_T.debug(\"Pos at {}\", posicaoAt);\n\n        // Muda a pos da que está na frente pra dela\n        Tarefa tLogoFrente = daoT.getByPosicao(posicaoAt - 1);\n        LOG_PAINEL_T.debug(\"Tarefa a frente: \" + tLogoFrente);\n\n        if (tLogoFrente == null) {\n            //Não tem antes. Simplismente mudar\n\n            tarefaMover.setPosicao(posicaoAt - 1);\n            tarefaMover.setDataModif(LocalDateTime.now());\n\n            daoT.atualiza(tarefaMover);\n\n            ((TableRowSorter) tabelaTarefas.getRowSorter()).sort();\n            return;\n        }\n\n        int posicaoAnt = modeloTabela.getTarefas().indexOf(tLogoFrente);\n        LOG_PAINEL_T.debug(\"Posição tarefa ant: \" + posicaoAnt);\n\n        tLogoFrente = modeloTabela.getTarefas().get(posicaoAnt);\n\n        //     modeloTabela.getTarefas().get(posicaoSelModelo - 1);/\n        LOG_PAINEL_T.debug(\"T acima {} em {}\", tLogoFrente.getTitulo(), posicaoAt - 1);\n\n        tLogoFrente.setPosicao(posicaoAt);\n\n        LOG_PAINEL_T.debug(\"Pos {} alt para {}\", tLogoFrente.getTitulo(), posicaoAt);\n\n        Integer posSucMaior = daoT.getMaiorPosicao() + 1;\n        LOG_PAINEL_T.debug(\"Próx m {}\", posSucMaior);\n        tarefaMover.setPosicao(posSucMaior);\n        tarefaMover.setDataModif(LocalDateTime.now());\n\n        modeloTabela.fireTableRowsUpdated(posicaoSelModelo, posicaoSelModelo);\n\n        daoT.atualiza(tarefaMover);\n\n        /*\n         * Aqui seria importante recarregar a tarefa do banco na tabela da janela\n         * principal\n         * \n         */\n        daoT.atualiza(tLogoFrente);\n\n        tarefaMover.setPosicao(posicaoAt - 1);\n        daoT.atualiza(tarefaMover);\n\n        // modeloTabela.setTarefas(daoT.listaTodas());\n        //modeloTabela.ordena();\n        ((TableRowSorter) tabelaTarefas.getRowSorter()).sort();\n\n        /**\n         * Após a ordenação a seleção é perdida\n         *\n         */\n        ListSelectionModel modeloSelecao = tabelaTarefas.getSelectionModel();\n\n        /**\n         * Importante não ser duplicada\n         */\n        LOG_PAINEL_T.debug((\"mudando sel\"));\n        int idxNovoModelo = modeloTabela.getTarefas().indexOf(tarefaMover);\n\n        LOG_PAINEL_T.debug(\"Novo índice tarefa modelo: {}\", idxNovoModelo);\n\n        int idxTabela = tabelaTarefas.convertRowIndexToView(idxNovoModelo);\n\n        LOG_PAINEL_T.debug(\"Novo índice tarefa tabela: {}\", idxTabela);\n\n        /**\n         * O parâmetro é o índice na tabela\n         */\n        modeloSelecao.setSelectionInterval(idxTabela, idxTabela);\n    }//GEN-LAST:event_btSubirActionPerformed\n\n    private void btDescerActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btDescerActionPerformed\n        LOG_PAINEL_T.traceEntry();\n\n        Tarefa tarefasDescer = modeloTabela.getTarefas()\n                .get(tabelaTarefas.convertRowIndexToModel(tabelaTarefas.getSelectedRow()));\n\n        if (tarefasDescer.getPosicao() >= modeloTabela.getTarefas().size() - 1) {\n            return;\n        }\n\n        Integer posicaoAt = tarefasDescer.getPosicao();\n\n        if (tarefasDescer.getPosicao() < modeloTabela.getTarefas().size() - 1) {\n            tarefasDescer.setPosicao(tarefasDescer.getPosicao() + 1);\n            LOG_PAINEL_T.debug(\"Pos alt para \" + tarefasDescer.getPosicao());\n        }\n\n        // Remove a pos\n        DAOTarefa daoT = new DAOTarefa();\n\n        tarefasDescer.setPosicao(daoT.getMaiorPosicao() + 1);\n        tarefasDescer.setDataModif(LocalDateTime.now());\n        daoT.atualiza(tarefasDescer);\n\n        LOG_PAINEL_T.debug(\"Tarefa movida para o fim. Pos: \" + tarefasDescer.getPosicao());\n\n        // TODO: Trocar posição da de baixo com a dela\n        Tarefa tarAbaixo = daoT.getByPosicao(posicaoAt + 1);\n        if (tarAbaixo != null) {\n            LOG_PAINEL_T.debug(\"Tarefa enc pos seg. pos: \" + (posicaoAt + 1));\n            tarAbaixo.setPosicao(posicaoAt);\n\n            daoT.atualiza(tarAbaixo);\n        }\n\n        // TODO: Rever ter se galhar\n        tarefasDescer.setPosicao(posicaoAt + 1);\n        daoT.atualiza(tarefasDescer);\n\n        modeloTabela.ordena();\n\n        /**\n         * Após a ordenação a seleção é perdida\n         *\n         */\n        ListSelectionModel modeloSelecao = tabelaTarefas.getSelectionModel();\n\n        /**\n         * Importante não ser duplicada\n         */\n        int idxNovoModelo = modeloTabela.getTarefas().indexOf(tarefasDescer);\n\n        LOG_PAINEL_T.debug(\"Novo índice tarefa modelo: {}\", idxNovoModelo);\n\n        int idxTabela = tabelaTarefas.convertRowIndexToView(idxNovoModelo);\n\n        LOG_PAINEL_T.debug(\"Novo índice tarefa tabela: {}\", idxTabela);\n\n        /**\n         * O parâmetro é o índice na tabela\n         */\n        modeloSelecao.setSelectionInterval(idxTabela, idxTabela);\n    }//GEN-LAST:event_btDescerActionPerformed\n\n    private void btVerTarefaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btVerTarefaActionPerformed\n        DialogoEditarTarefa dialogEditar = new DialogoEditarTarefa(dono, modeloTabela);\n        Tarefa t = modeloTabela.getTarefas().get(tabelaTarefas.convertRowIndexToModel(tabelaTarefas.getSelectedRow()));\n        dialogEditar.setTarefa(t);\n        dialogEditar.setVisible(true);\n    }//GEN-LAST:event_btVerTarefaActionPerformed\n\n    private void btDiminuiPrioActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btDiminuiPrioActionPerformed\n        LOG_PAINEL_T.traceEntry();\n\n//        JTable tabelaTarefas = painelTabelaTarefas.getTabelaTarefas();\n//        ModeloTabelaTarefasLista modeloTabela = painelTabelaTarefas.getModeloTabela();\n        // A linha escolhida na tabela\n        int linhaSel = tabelaTarefas.getSelectedRow();\n        LOG_PAINEL_T.debug(\"Linha tab: \" + linhaSel);\n\n        // Posição da tarefa no modelo\n        int posicaoSelModelo = tabelaTarefas.convertRowIndexToModel(linhaSel);\n\n        LOG_PAINEL_T.debug(\"Posiçaõ sel mod: \" + posicaoSelModelo);\n\n        Tarefa tarefaMover = modeloTabela.getTarefas().get(posicaoSelModelo);\n        LOG_PAINEL_T.debug(\"Prioridade: \" + tarefaMover.getPrioridade());\n\n        LOG_PAINEL_T.debug(\"Tarefa mover: \" + tarefaMover.getTitulo());\n\n        tarefaMover.diminuiPrio();\n        tarefaMover.setDataModif(LocalDateTime.now());\n        DAOTarefa daoT = new DAOTarefa();\n        daoT.atualiza(tarefaMover);\n\n        LOG_PAINEL_T.debug(\"Nova prioridade: \" + tarefaMover.getPrioridade());\n\n        //  modeloTabela.fireTableRowsUpdated(linhaSel, linhaSel);\n        int idxCol = tabelaTarefas.getColumn(\"Prioridade\").getModelIndex();\n        int idxColM = tabelaTarefas.getColumn(\"Data modif\").getModelIndex();\n        modeloTabela.fireTableCellUpdated(linhaSel, idxCol);\n        modeloTabela.fireTableCellUpdated(linhaSel, idxColM);\n        ((TableRowSorter) tabelaTarefas.getRowSorter()).sort();\n    }//GEN-LAST:event_btDiminuiPrioActionPerformed\n\n    private void btVerComentariosActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btVerComentariosActionPerformed\n        DialogoVerComentarios verComent = new DialogoVerComentarios(dono,\n                modeloTabela);\n        Tarefa t = modeloTabela.getTarefas().get(tabelaTarefas.\n                convertRowIndexToModel(tabelaTarefas.getSelectedRow()));\n        verComent.setTarefa(t);\n        verComent.setVisible(true);\n    }//GEN-LAST:event_btVerComentariosActionPerformed\n\n\n    // Variables declaration - do not modify//GEN-BEGIN:variables\n    private javax.swing.JButton btAumentPrio;\n    private javax.swing.JButton btDescer;\n    private javax.swing.JButton btDiminuiPrio;\n    private javax.swing.JButton btSubir;\n    private javax.swing.JButton btVerComentarios;\n    private javax.swing.JButton btVerTarefa;\n    // End of variables declaration//GEN-END:variables\n}\n"
        }
    ]
}